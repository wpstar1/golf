<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2ecc71">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>â›³ ê³¨í”„ ìŠ¤ì½”ì–´ ë¼ì´ë¸Œ</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Malgun Gothic', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: manipulation;
        }

        .app {
            width: 100vw;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            background: white;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: env(safe-area-inset-top, 20px) 12px 12px;
            padding-top: calc(env(safe-area-inset-top, 20px) + 12px);
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .header h1 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 700;
        }

        .menu-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
        }

        .tab-bar {
            display: flex;
            background: rgba(0,0,0,0.1);
            border-radius: 20px;
            padding: 3px;
            margin-top: 8px;
        }

        .tab {
            flex: 1;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            padding: 8px 4px;
            border-radius: 17px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
            cursor: pointer;
        }

        .tab.active {
            background: white;
            color: #27ae60;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            position: relative;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        .screen {
            display: none;
            padding: 12px;
            animation: slideIn 0.3s ease;
            min-height: 100%;
            padding-bottom: calc(60px + env(safe-area-inset-bottom, 0));
        }

        .screen.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .camera-section {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .camera-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4/3;
            background: black;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        #video, #canvas, #uploadedImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .camera-placeholder .icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .camera-placeholder p {
            font-size: 0.9rem;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 8px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            cursor: pointer;
            min-height: 44px;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn-full {
            grid-column: 1 / -1;
        }

        .score-card {
            background: white;
            border-radius: 16px;
            padding: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 12px;
        }

        .course-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .input-group label {
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
        }

        .input-group input, .input-group select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            background: white;
            transition: all 0.3s;
            min-height: 44px;
            width: 100%;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
        }

        .players-list {
            margin-top: 12px;
        }

        .player-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            transition: all 0.3s;
            min-height: 60px;
        }

        .player-card:active {
            transform: scale(0.98);
        }

        .player-rank {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            flex-shrink: 0;
        }

        .player-rank.first {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .player-info {
            flex: 1;
            min-width: 0;
        }

        .player-name {
            font-weight: 700;
            font-size: 1rem;
            color: #2c3e50;
            margin-bottom: 4px;
            word-break: keep-all;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-stats {
            display: flex;
            gap: 12px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #999;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-value.under {
            color: #e74c3c;
        }

        .stat-value.even {
            color: #2c3e50;
        }

        .stat-value.over {
            color: #3498db;
        }

        .preview-container {
            position: relative;
            width: 100%;
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        #previewCanvas {
            width: 100%;
            display: block;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            padding: 8px 0 env(safe-area-inset-bottom, 8px);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 5px;
            border: none;
            background: none;
            color: #999;
            transition: all 0.3s;
            cursor: pointer;
            min-height: 44px;
        }

        .nav-item.active {
            color: #2ecc71;
        }

        .nav-item .icon {
            font-size: 1.3rem;
        }

        .nav-item .label {
            font-size: 0.7rem;
            font-weight: 600;
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #uploadInput {
            display: none;
        }

        /* iOS ì•ˆì „ ì˜ì—­ ëŒ€ì‘ */
        @supports (padding: max(0px)) {
            .header {
                padding-top: max(20px, env(safe-area-inset-top));
            }

            .bottom-nav {
                padding-bottom: max(8px, env(safe-area-inset-bottom));
            }
        }

        /* ì‘ì€ í™”ë©´ ìµœì í™” */
        @media screen and (max-height: 667px) {
            .header h1 {
                font-size: 1.2rem;
            }

            .tab {
                font-size: 0.8rem;
                padding: 6px 4px;
            }

            .btn {
                padding: 10px 6px;
                font-size: 0.85rem;
            }

            .player-card {
                padding: 10px;
                min-height: 55px;
            }
        }

        /* ë§¤ìš° ì‘ì€ í™”ë©´ (SE ë“±) */
        @media screen and (max-width: 320px) {
            .header h1 {
                font-size: 1.1rem;
            }

            .course-info {
                grid-template-columns: 1fr;
            }

            .btn-group {
                grid-template-columns: 1fr;
            }

            .btn {
                font-size: 0.85rem;
            }
        }

        /* ê°€ë¡œ ëª¨ë“œ ì°¨ë‹¨ ìŠ¤íƒ€ì¼ */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            .app::before {
                content: "ğŸ“± ì„¸ë¡œ ëª¨ë“œë¡œ ì‚¬ìš©í•´ì£¼ì„¸ìš”";
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.2rem;
                font-weight: 600;
                z-index: 9999;
            }
        }

        /* í„°ì¹˜ ë°˜ì‘ ê°œì„  */
        @media (hover: none) and (pointer: coarse) {
            .btn:active,
            .nav-item:active {
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div class="header-top">
                <h1>â›³ ê³¨í”„ ìŠ¤ì½”ì–´ ë¼ì´ë¸Œ</h1>
                <button class="menu-btn">âš™ï¸</button>
            </div>
            <div class="tab-bar">
                <button class="tab active" data-screen="camera">ğŸ“¸ ì¹´ë©”ë¼</button>
                <button class="tab" data-screen="score">ğŸŒï¸ ìŠ¤ì½”ì–´</button>
                <button class="tab" data-screen="preview">ğŸ“± ë¯¸ë¦¬ë³´ê¸°</button>
            </div>
        </div>

        <div class="content">
            <!-- ì¹´ë©”ë¼ ìŠ¤í¬ë¦° -->
            <div class="screen active" id="camera-screen">
                <div class="camera-section">
                    <div class="camera-container">
                        <video id="video" style="display: none;" playsinline></video>
                        <canvas id="canvas" style="display: none;"></canvas>
                        <img id="uploadedImage" style="display: none;">
                        <div class="camera-placeholder" id="placeholder">
                            <div class="icon">ğŸ“·</div>
                            <p>ì‚¬ì§„ì„ ì°ê±°ë‚˜ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" id="startCamera">
                            ğŸ“¹ ì¹´ë©”ë¼ ì‹œì‘
                        </button>
                        <button class="btn btn-warning" id="uploadPhoto">
                            ğŸ“ ì‚¬ì§„ ì„ íƒ
                        </button>
                        <button class="btn btn-success btn-full" id="capturePhoto" style="display: none;">
                            ğŸ“¸ ì‚¬ì§„ ì°ê¸°
                        </button>
                    </div>
                </div>

                <div class="score-card">
                    <h3 style="margin-bottom: 12px; font-size: 1rem;">ğŸŒï¸ í´ëŸ½ & ì½”ìŠ¤ ì •ë³´</h3>
                    <div class="input-group" style="margin-bottom: 12px;">
                        <label>í´ëŸ½ ì´ë¦„</label>
                        <input type="text" id="clubName" value="ê¿€ì¼" placeholder="ì˜ˆ: ê¿€ì¼, ë²„ë””">
                    </div>
                    <div class="course-info">
                        <div class="input-group">
                            <label>ê³¨í”„ì¥</label>
                            <input type="text" id="courseName" value="ì œì£¼ ë‚˜ì¸ë¸Œë¦¿ì§€">
                        </div>
                        <div class="input-group">
                            <label>í˜„ì¬ í™€</label>
                            <select id="holeNumber">
                                <option value="1">1ë²ˆ í™€</option>
                                <option value="2">2ë²ˆ í™€</option>
                                <option value="3">3ë²ˆ í™€</option>
                                <option value="4" selected>4ë²ˆ í™€</option>
                                <option value="5">5ë²ˆ í™€</option>
                                <option value="6">6ë²ˆ í™€</option>
                                <option value="7">7ë²ˆ í™€</option>
                                <option value="8">8ë²ˆ í™€</option>
                                <option value="9">9ë²ˆ í™€</option>
                                <option value="10">10ë²ˆ í™€</option>
                                <option value="11">11ë²ˆ í™€</option>
                                <option value="12">12ë²ˆ í™€</option>
                                <option value="13">13ë²ˆ í™€</option>
                                <option value="14">14ë²ˆ í™€</option>
                                <option value="15">15ë²ˆ í™€</option>
                                <option value="16">16ë²ˆ í™€</option>
                                <option value="17">17ë²ˆ í™€</option>
                                <option value="18">18ë²ˆ í™€</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìŠ¤ì½”ì–´ ìŠ¤í¬ë¦° -->
            <div class="screen" id="score-screen">
                <div class="players-list" id="playersList">
                    <!-- í”Œë ˆì´ì–´ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                </div>
            </div>

            <!-- ë¯¸ë¦¬ë³´ê¸° ìŠ¤í¬ë¦° -->
            <div class="screen" id="preview-screen">
                <div class="preview-container">
                    <canvas id="previewCanvas"></canvas>
                    <div class="camera-placeholder" id="previewPlaceholder">
                        <div class="icon">ğŸ–¼ï¸</div>
                        <p>ë¨¼ì € ì‚¬ì§„ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”</p>
                    </div>
                </div>

                <div class="score-card">
                    <h3 style="margin-bottom: 8px; font-size: 1rem;">ğŸ“ ì˜¤ë²„ë ˆì´ ë°°ì¹˜</h3>
                    <div style="padding: 12px; background: #f0f0f0; border-radius: 8px; font-size: 0.85rem; color: #666; line-height: 1.4;">
                        âœ… ì™¼ìª½ ìƒë‹¨: ê³¨í”„ì¥ ì´ë¦„<br>
                        âœ… ì˜¤ë¥¸ìª½ ìƒë‹¨: í´ëŸ½ ì´ë¦„<br>
                        âœ… ì˜¤ë¥¸ìª½ í•˜ë‹¨: ìŠ¤ì½”ì–´ë³´ë“œ
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" id="downloadBtn">
                        ğŸ’¾ ì €ì¥
                    </button>
                    <button class="btn btn-primary" id="shareBtn">
                        ğŸ“¤ ê³µìœ 
                    </button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="nav-item active" data-screen="camera">
                <span class="icon">ğŸ“·</span>
                <span class="label">ì¹´ë©”ë¼</span>
            </button>
            <button class="nav-item" data-screen="score">
                <span class="icon">ğŸŒï¸</span>
                <span class="label">ìŠ¤ì½”ì–´</span>
            </button>
            <button class="nav-item" data-screen="preview">
                <span class="icon">ğŸ“±</span>
                <span class="label">ë¯¸ë¦¬ë³´ê¸°</span>
            </button>
            <button class="nav-item" id="quickShare">
                <span class="icon">âœ¨</span>
                <span class="label">ë¹ ë¥¸ê³µìœ </span>
            </button>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <input type="file" id="uploadInput" accept="image/*" capture="environment">

    <script>
        // ë·°í¬íŠ¸ ë†’ì´ ì„¤ì • (iOS ëŒ€ì‘)
        function setViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        setViewportHeight();
        window.addEventListener('resize', setViewportHeight);
        window.addEventListener('orientationchange', setViewportHeight);

        // iOS ë°”ìš´ìŠ¤ ìŠ¤í¬ë¡¤ ë°©ì§€
        document.addEventListener('touchmove', function(e) {
            if (!e.target.closest('.content')) {
                e.preventDefault();
            }
        }, { passive: false });

        // ì „ì—­ ë³€ìˆ˜
        let players = [];
        let stream = null;
        let capturedImage = null;
        let overlayPosition = 'bottom-right';
        let currentScreen = 'camera';

        // ìë™ ì €ì¥/ë¡œë“œ ê¸°ëŠ¥
        function saveData() {
            const data = {
                players: players,
                clubName: document.getElementById('clubName').value,
                courseName: document.getElementById('courseName').value,
                holeNumber: document.getElementById('holeNumber').value,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('golfScoreData', JSON.stringify(data));
            console.log('ë°ì´í„° ì €ì¥ë¨:', data);
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('golfScoreData');
                if (savedData) {
                    const data = JSON.parse(savedData);

                    // ê³ ì • 4ëª… í”Œë ˆì´ì–´ ë°ì´í„° ë¡œë“œ
                    if (data.players && data.players.length === 4) {
                        players = data.players;
                    } else {
                        // ê¸°ë³¸ 4ëª… í”Œë ˆì´ì–´ ë°ì´í„°
                        players = [
                            { name: 'í™ê¸¸ë™', score: -2, total: 34 },
                            { name: 'ê¹€ì² ìˆ˜', score: 0, total: 36 },
                            { name: 'ì´ì˜í¬', score: 3, total: 39 },
                            { name: 'ë°•ë¯¼ìˆ˜', score: 5, total: 41 }
                        ];
                    }

                    // í¼ ë°ì´í„° ë¡œë“œ
                    if (data.clubName) document.getElementById('clubName').value = data.clubName;
                    if (data.courseName) document.getElementById('courseName').value = data.courseName;
                    if (data.holeNumber) document.getElementById('holeNumber').value = data.holeNumber;

                    console.log('ë°ì´í„° ë¡œë“œë¨:', data);
                } else {
                    // ì²˜ìŒ ì‚¬ìš© ì‹œ ê¸°ë³¸ 4ëª… ë°ì´í„°
                    players = [
                        { name: 'í™ê¸¸ë™', score: -2, total: 34 },
                        { name: 'ê¹€ì² ìˆ˜', score: 0, total: 36 },
                        { name: 'ì´ì˜í¬', score: 3, total: 39 },
                        { name: 'ë°•ë¯¼ìˆ˜', score: 5, total: 41 }
                    ];
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                // ê¸°ë³¸ 4ëª… ë°ì´í„°ë¡œ ì´ˆê¸°í™”
                players = [
                    { name: 'í™ê¸¸ë™', score: -2, total: 34 },
                    { name: 'ê¹€ì² ìˆ˜', score: 0, total: 36 },
                    { name: 'ì´ì˜í¬', score: 3, total: 39 },
                    { name: 'ë°•ë¯¼ìˆ˜', score: 5, total: 41 }
                ];
            }
        }

        // DOM ìš”ì†Œ
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const previewCanvas = document.getElementById('previewCanvas');
        const previewCtx = previewCanvas.getContext('2d');

        // íƒ­ ì „í™˜
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const screen = tab.dataset.screen;
                switchScreen(screen);

                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
        });

        // í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const screen = item.dataset.screen;
                if (screen) {
                    switchScreen(screen);

                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    item.classList.add('active');

                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                        if (t.dataset.screen === screen) {
                            t.classList.add('active');
                        }
                    });
                }
            });
        });

        // í™”ë©´ ì „í™˜
        function switchScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`${screen}-screen`).classList.add('active');
            currentScreen = screen;

            if (screen === 'preview') {
                updatePreview();
            }
        }

        // ì¹´ë©”ë¼ ì‹œì‘
        document.getElementById('startCamera').addEventListener('click', async () => {
            const btn = document.getElementById('startCamera');

            if (stream) {
                // ì¹´ë©”ë¼ ì¤‘ì§€
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.style.display = 'none';
                document.getElementById('placeholder').style.display = 'flex';
                document.getElementById('capturePhoto').style.display = 'none';
                btn.innerHTML = 'ğŸ“¹ ì¹´ë©”ë¼ ì‹œì‘';
            } else {
                // ì¹´ë©”ë¼ ì‹œì‘
                try {
                    const constraints = {
                        video: {
                            facingMode: { ideal: 'environment' },
                            width: { ideal: 1920 },
                            height: { ideal: 1080 }
                        }
                    };

                    stream = await navigator.mediaDevices.getUserMedia(constraints);
                    video.srcObject = stream;
                    video.style.display = 'block';
                    document.getElementById('placeholder').style.display = 'none';
                    document.getElementById('capturePhoto').style.display = 'block';
                    btn.innerHTML = 'ğŸ”´ ì¹´ë©”ë¼ ì¤‘ì§€';

                    video.addEventListener('loadedmetadata', () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                    });
                } catch (err) {
                    console.error('ì¹´ë©”ë¼ ì˜¤ë¥˜:', err);
                    alert('ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì¹´ë©”ë¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            }
        });

        // ì‚¬ì§„ ì´¬ì˜
        document.getElementById('capturePhoto').addEventListener('click', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);

            capturedImage = new Image();
            capturedImage.src = canvas.toDataURL('image/jpeg', 0.9);
            capturedImage.onload = () => {
                canvas.style.display = 'block';
                video.style.display = 'none';
                document.getElementById('capturePhoto').style.display = 'none';
                document.getElementById('placeholder').style.display = 'none';
                updatePreview();

                // ì¹´ë©”ë¼ ì¤‘ì§€
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    stream = null;
                    document.getElementById('startCamera').innerHTML = 'ğŸ“¹ ì¹´ë©”ë¼ ì‹œì‘';
                }
            };
        });

        // ì‚¬ì§„ ì—…ë¡œë“œ
        document.getElementById('uploadPhoto').addEventListener('click', () => {
            document.getElementById('uploadInput').click();
        });

        document.getElementById('uploadInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    capturedImage = new Image();
                    capturedImage.onload = () => {
                        canvas.width = capturedImage.width;
                        canvas.height = capturedImage.height;
                        ctx.drawImage(capturedImage, 0, 0);
                        canvas.style.display = 'block';
                        document.getElementById('placeholder').style.display = 'none';
                        document.getElementById('uploadedImage').src = e.target.result;
                        updatePreview();
                    };
                    capturedImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updatePlayersList() {
            const container = document.getElementById('playersList');
            container.innerHTML = '';

            players.sort((a, b) => a.score - b.score);

            players.forEach((player, index) => {
                const scoreClass = player.score < 0 ? 'under' : player.score > 0 ? 'over' : 'even';
                const scoreText = player.score > 0 ? `+${player.score}` : player.score === 0 ? 'E' : `${player.score}`;

                const card = document.createElement('div');
                card.className = 'player-card';
                card.innerHTML = `
                    <div class="player-rank ${index === 0 ? 'first' : ''}">${index + 1}</div>
                    <div class="player-info">
                        <div class="player-name" contenteditable="true" data-field="name" data-index="${index}">${player.name}</div>
                        <div class="player-stats">
                            <div class="stat">
                                <div class="stat-label">ìŠ¤ì½”ì–´</div>
                                <div class="stat-value ${scoreClass}" contenteditable="true" data-field="score" data-index="${index}">${scoreText}</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">ì´íƒ€ìˆ˜</div>
                                <div class="stat-value" contenteditable="true" data-field="total" data-index="${index}">${player.total}</div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);

                // ì´ë¦„ê³¼ ìŠ¤ì½”ì–´ í¸ì§‘ ê°€ëŠ¥
                const editableElements = card.querySelectorAll('[contenteditable="true"]');
                editableElements.forEach(element => {
                    element.addEventListener('blur', handlePlayerEdit);
                    element.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            element.blur();
                        }
                    });
                });
            });
        }

        // í”Œë ˆì´ì–´ ì •ë³´ í¸ì§‘ ì²˜ë¦¬
        function handlePlayerEdit(event) {
            const element = event.target;
            const field = element.dataset.field;
            const index = parseInt(element.dataset.index);
            let value = element.textContent.trim();

            if (field === 'name') {
                // ì´ë¦„ ìˆ˜ì •
                if (value && value.length <= 10) {
                    players[index].name = value;
                    updatePlayersList();
                    updatePreview();
                    saveData();
                } else {
                    updatePlayersList();
                }
            } else if (field === 'score') {
                // ìŠ¤ì½”ì–´ íŒŒì‹±
                let scoreValue;
                if (value.toLowerCase() === 'e') {
                    scoreValue = 0;
                } else {
                    scoreValue = parseInt(value.replace(/[^-\d]/g, ''));
                }

                if (!isNaN(scoreValue) && scoreValue >= -10 && scoreValue <= 15) {
                    players[index].score = scoreValue;
                    const currentHole = parseInt(document.getElementById('holeNumber').value);
                    const basePar = 72;
                    const estimatedTotal = basePar + scoreValue;
                    players[index].total = Math.max(18, estimatedTotal);

                    updatePlayersList();
                    updatePreview();
                    saveData();
                } else {
                    updatePlayersList();
                }
            } else if (field === 'total') {
                // ì´íƒ€ìˆ˜ ìˆ˜ì •
                const totalValue = parseInt(value);
                if (!isNaN(totalValue) && totalValue >= 18 && totalValue <= 150) {
                    players[index].total = totalValue;
                    updatePlayersList();
                    updatePreview();
                    saveData();
                } else {
                    updatePlayersList();
                }
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            if (!capturedImage) {
                document.getElementById('previewPlaceholder').style.display = 'flex';
                previewCanvas.style.display = 'none';
                return;
            }

            document.getElementById('previewPlaceholder').style.display = 'none';
            previewCanvas.style.display = 'block';

            previewCanvas.width = capturedImage.width;
            previewCanvas.height = capturedImage.height;

            previewCtx.drawImage(capturedImage, 0, 0);
            drawOverlay(previewCtx, previewCanvas.width, previewCanvas.height);
        }

        // ì˜¤ë²„ë ˆì´ ê·¸ë¦¬ê¸° (ëª¨ë°”ì¼ ìµœì í™”)
        function drawOverlay(ctx, canvasWidth, canvasHeight) {
            const scale = Math.min(canvasWidth, canvasHeight) / 1000;
            const padding = 15 * scale;

            // í˜„ì¬ ì‹œê°„
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });

            // 1. ìƒë‹¨ ì¤‘ì•™ - í™€ ë²ˆí˜¸ì™€ ì‹œê°„ (ëª¨ë°”ì¼ ìµœì í™” í¬ê¸°)
            const holeNumber = document.getElementById('holeNumber').value;
            const topBarWidth = 260 * scale;
            const topBarHeight = 60 * scale;
            const topBarX = (canvasWidth - topBarWidth) / 2;
            const topBarY = padding;

            // ìƒë‹¨ ë°” ë°°ê²½
            const topGradient = ctx.createLinearGradient(topBarX, topBarY, topBarX, topBarY + topBarHeight);
            topGradient.addColorStop(0, 'rgba(15, 76, 129, 0.95)');
            topGradient.addColorStop(0.5, 'rgba(9, 132, 227, 0.9)');
            topGradient.addColorStop(1, 'rgba(30, 144, 255, 0.95)');
            ctx.fillStyle = topGradient;
            roundRect(ctx, topBarX, topBarY, topBarWidth, topBarHeight, 6 * scale);
            ctx.fill();

            // ìƒë‹¨ ë°” í…Œë‘ë¦¬
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1.5 * scale;
            roundRect(ctx, topBarX, topBarY, topBarWidth, topBarHeight, 6 * scale);
            ctx.stroke();

            // PAR 4 í‘œì‹œ
            ctx.fillStyle = 'white';
            ctx.font = `bold ${14 * scale}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText('PAR 4', topBarX + topBarWidth/2, topBarY + 18 * scale);

            // í™€ ë²ˆí˜¸
            ctx.font = `bold ${28 * scale}px Arial`;
            ctx.fillText(holeNumber, topBarX + 50 * scale, topBarY + 42 * scale);

            // ì‹œê°„
            ctx.font = `${12 * scale}px Arial`;
            ctx.fillText(timeString, topBarX + topBarWidth - 50 * scale, topBarY + 22 * scale);

            // ë‚ ì§œ
            const dateString = now.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'long' });
            ctx.font = `${10 * scale}px Arial`;
            ctx.fillText(dateString, topBarX + topBarWidth - 50 * scale, topBarY + 38 * scale);

            // 2. ì™¼ìª½ ìƒë‹¨ - ê³¨í”„ì¥ ì´ë¦„
            const courseName = document.getElementById('courseName').value;
            if (courseName) {
                const courseWidth = 220 * scale;
                const courseHeight = 45 * scale;
                const courseX = padding;
                const courseY = padding;

                // ë°°ê²½
                const courseGradient = ctx.createLinearGradient(courseX, courseY, courseX, courseY + courseHeight);
                courseGradient.addColorStop(0, 'rgba(0, 0, 0, 0.85)');
                courseGradient.addColorStop(1, 'rgba(0, 0, 0, 0.75)');
                ctx.fillStyle = courseGradient;
                roundRect(ctx, courseX, courseY, courseWidth, courseHeight, 6 * scale);
                ctx.fill();

                // í…Œë‘ë¦¬
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1.5 * scale;
                roundRect(ctx, courseX, courseY, courseWidth, courseHeight, 6 * scale);
                ctx.stroke();

                // í…ìŠ¤íŠ¸
                ctx.fillStyle = 'white';
                ctx.font = `bold ${16 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(courseName, courseX + courseWidth/2, courseY + 28 * scale);
            }

            // 3. ì˜¤ë¥¸ìª½ ìƒë‹¨ - í´ëŸ½ ì´ë¦„
            const clubName = document.getElementById('clubName').value;
            if (clubName) {
                const clubWidth = 160 * scale;
                const clubHeight = 45 * scale;
                const clubX = canvasWidth - clubWidth - padding;
                const clubY = padding;

                // í´ëŸ½ ë°°ê²½
                const clubGradient = ctx.createLinearGradient(clubX, clubY, clubX, clubY + clubHeight);
                clubGradient.addColorStop(0, '#4CAF50');
                clubGradient.addColorStop(0.5, '#388E3C');
                clubGradient.addColorStop(1, '#2E7D32');
                ctx.fillStyle = clubGradient;
                roundRect(ctx, clubX, clubY, clubWidth, clubHeight, 6 * scale);
                ctx.fill();

                // í…Œë‘ë¦¬
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1.5 * scale;
                roundRect(ctx, clubX, clubY, clubWidth, clubHeight, 6 * scale);
                ctx.stroke();

                // í´ëŸ½ í…ìŠ¤íŠ¸
                ctx.fillStyle = 'white';
                ctx.font = `bold ${18 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(clubName, clubX + clubWidth/2, clubY + 28 * scale);
            }

            // 4. ì˜¤ë¥¸ìª½ í•˜ë‹¨ - ëª¨ë°”ì¼ ìµœì í™” ìŠ¤ì½”ì–´ë³´ë“œ
            const scoreWidth = 340 * scale;
            const headerHeight = 40 * scale;
            const rowHeight = 40 * scale;
            const scoreHeight = headerHeight + (players.length * rowHeight) + 8 * scale;
            const scoreX = canvasWidth - scoreWidth - padding;
            const scoreY = canvasHeight - scoreHeight - padding;

            // ë©”ì¸ ìŠ¤ì½”ì–´ë³´ë“œ ë°°ê²½
            ctx.fillStyle = 'rgba(0, 0, 0, 0.85)';
            roundRect(ctx, scoreX, scoreY, scoreWidth, scoreHeight, 10 * scale);
            ctx.fill();

            // í—¤ë” ë°°ê²½
            const headerGradient = ctx.createLinearGradient(scoreX, scoreY, scoreX, scoreY + headerHeight);
            headerGradient.addColorStop(0, '#1565C0');
            headerGradient.addColorStop(0.5, '#1976D2');
            headerGradient.addColorStop(1, '#1E88E5');
            ctx.fillStyle = headerGradient;
            roundRect(ctx, scoreX, scoreY, scoreWidth, headerHeight, [10 * scale, 10 * scale, 0, 0]);
            ctx.fill();

            // í—¤ë” êµ¬ë¶„ì„ 
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1 * scale;
            ctx.beginPath();
            ctx.moveTo(scoreX + 45 * scale, scoreY + 8 * scale);
            ctx.lineTo(scoreX + 45 * scale, scoreY + headerHeight - 8 * scale);
            ctx.moveTo(scoreX + 180 * scale, scoreY + 8 * scale);
            ctx.lineTo(scoreX + 180 * scale, scoreY + headerHeight - 8 * scale);
            ctx.moveTo(scoreX + 250 * scale, scoreY + 8 * scale);
            ctx.lineTo(scoreX + 250 * scale, scoreY + headerHeight - 8 * scale);
            ctx.stroke();

            // í—¤ë” í…ìŠ¤íŠ¸
            ctx.fillStyle = 'white';
            ctx.font = `bold ${12 * scale}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText('#', scoreX + 22 * scale, scoreY + 25 * scale);
            ctx.fillText('PLAYER', scoreX + 112 * scale, scoreY + 25 * scale);
            ctx.fillText('SPT', scoreX + 215 * scale, scoreY + 25 * scale);
            ctx.fillText('TOTAL', scoreX + 295 * scale, scoreY + 25 * scale);

            // í”Œë ˆì´ì–´ í–‰ë“¤
            players.forEach((player, index) => {
                const playerY = scoreY + headerHeight + (index * rowHeight);
                const isLeader = index === 0;

                // í–‰ ë°°ê²½
                if (isLeader) {
                    const leaderGradient = ctx.createLinearGradient(scoreX, playerY, scoreX, playerY + rowHeight);
                    leaderGradient.addColorStop(0, 'rgba(255, 193, 7, 0.2)');
                    leaderGradient.addColorStop(1, 'rgba(255, 235, 59, 0.1)');
                    ctx.fillStyle = leaderGradient;
                } else {
                    ctx.fillStyle = index % 2 === 1 ? 'rgba(255, 255, 255, 0.05)' : 'transparent';
                }
                ctx.fillRect(scoreX, playerY, scoreWidth, rowHeight);

                // í–‰ êµ¬ë¶„ì„ 
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1 * scale;
                ctx.beginPath();
                ctx.moveTo(scoreX + 45 * scale, playerY);
                ctx.lineTo(scoreX + 45 * scale, playerY + rowHeight);
                ctx.moveTo(scoreX + 180 * scale, playerY);
                ctx.lineTo(scoreX + 180 * scale, playerY + rowHeight);
                ctx.moveTo(scoreX + 250 * scale, playerY);
                ctx.lineTo(scoreX + 250 * scale, playerY + rowHeight);
                ctx.stroke();

                // ìˆœìœ„
                const rankCircleSize = 20 * scale;
                ctx.fillStyle = isLeader ? '#FFD700' : '#64B5F6';
                ctx.beginPath();
                ctx.arc(scoreX + 22 * scale, playerY + rowHeight/2, rankCircleSize/2, 0, Math.PI * 2);
                ctx.fill();

                // ìˆœìœ„ ìˆ«ì
                ctx.fillStyle = isLeader ? '#000' : 'white';
                ctx.font = `bold ${14 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(`${index + 1}`, scoreX + 22 * scale, playerY + rowHeight/2 + 4 * scale);

                // í”Œë ˆì´ì–´ ì´ë¦„
                ctx.fillStyle = 'white';
                ctx.font = `bold ${16 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(player.name, scoreX + 112 * scale, playerY + rowHeight/2 + 5 * scale);

                // ìŠ¤ì½”ì–´
                const scoreText = player.score > 0 ? `+${player.score}` : player.score === 0 ? 'E' : `${player.score}`;
                ctx.fillStyle = player.score < 0 ? '#4CAF50' : player.score > 0 ? '#F44336' : '#FFF';
                ctx.font = `bold ${18 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(scoreText, scoreX + 215 * scale, playerY + rowHeight/2 + 5 * scale);

                // ì´íƒ€ìˆ˜
                ctx.fillStyle = 'white';
                ctx.font = `bold ${18 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(player.total, scoreX + 295 * scale, playerY + rowHeight/2 + 5 * scale);
            });

            // ìŠ¤ì½”ì–´ë³´ë“œ í•˜ë‹¨ ë¸Œëœë”©
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.font = `${10 * scale}px Arial`;
            ctx.textAlign = 'right';
            ctx.fillText('LIVE', scoreX + scoreWidth - 8 * scale, scoreY + scoreHeight - 6 * scale);
        }

        // RoundRect í—¬í¼ í•¨ìˆ˜
        function roundRect(ctx, x, y, width, height, radius) {
            if (typeof radius === 'number') {
                radius = [radius, radius, radius, radius];
            } else if (Array.isArray(radius) && radius.length === 2) {
                radius = [radius[0], radius[0], radius[1], radius[1]];
            }

            ctx.beginPath();
            ctx.moveTo(x + radius[0], y);
            ctx.lineTo(x + width - radius[1], y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius[1]);
            ctx.lineTo(x + width, y + height - radius[2]);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius[2], y + height);
            ctx.lineTo(x + radius[3], y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius[3]);
            ctx.lineTo(x, y + radius[0]);
            ctx.quadraticCurveTo(x, y, x + radius[0], y);
            ctx.closePath();
        }

        // ë‹¤ìš´ë¡œë“œ
        document.getElementById('downloadBtn').addEventListener('click', () => {
            if (!capturedImage) {
                alert('ë¨¼ì € ì‚¬ì§„ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”!');
                return;
            }

            try {
                updatePreview();

                const timestamp = new Date().toISOString().slice(0, 19).replace(/[-:]/g, '').replace('T', '_');
                const filename = `golf_score_${timestamp}.jpg`;

                previewCanvas.toBlob((blob) => {
                    if (blob) {
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = filename;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);

                        alert(`ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${filename}`);
                    } else {
                        const link = document.createElement('a');
                        link.download = filename;
                        link.href = previewCanvas.toDataURL('image/jpeg', 0.95);
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        alert(`ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${filename}`);
                    }
                }, 'image/jpeg', 0.95);
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        });

        // ê³µìœ 
        document.getElementById('shareBtn').addEventListener('click', async () => {
            if (!capturedImage) {
                alert('ë¨¼ì € ì‚¬ì§„ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”!');
                return;
            }

            try {
                previewCanvas.toBlob(async (blob) => {
                    if (navigator.share && navigator.canShare) {
                        const file = new File([blob], 'golf_score.jpg', { type: 'image/jpeg' });
                        const shareData = {
                            files: [file],
                            title: 'ê³¨í”„ ìŠ¤ì½”ì–´',
                            text: 'ê³¨í”„ ë¼ìš´ë”© ì‹¤ì‹œê°„ ìŠ¤ì½”ì–´'
                        };

                        if (navigator.canShare(shareData)) {
                            await navigator.share(shareData);
                        } else {
                            copyToClipboard(blob);
                        }
                    } else {
                        copyToClipboard(blob);
                    }
                }, 'image/jpeg', 0.9);
            } catch (err) {
                alert('ê³µìœ  ì‹¤íŒ¨: ' + err.message);
            }
        });

        // í´ë¦½ë³´ë“œ ë³µì‚¬
        async function copyToClipboard(blob) {
            try {
                const item = new ClipboardItem({ 'image/png': blob });
                await navigator.clipboard.write([item]);
                alert('ì´ë¯¸ì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì¹´í†¡ì—ì„œ ë¶™ì—¬ë„£ê¸°í•˜ì„¸ìš”.');
            } catch (err) {
                alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err.message);
            }
        }

        // ë¹ ë¥¸ ê³µìœ 
        document.getElementById('quickShare').addEventListener('click', () => {
            if (!capturedImage) {
                alert('ë¨¼ì € ì‚¬ì§„ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”!');
                switchScreen('camera');
                return;
            }

            document.getElementById('loading').classList.add('active');

            setTimeout(() => {
                updatePreview();
                document.getElementById('shareBtn').click();
                document.getElementById('loading').classList.remove('active');
            }, 500);
        });

        // ì´ˆê¸°í™”
        loadData();
        updatePlayersList();

        // ì½”ìŠ¤ ì •ë³´ ë³€ê²½ ì‹œ ì—…ë°ì´íŠ¸
        document.getElementById('clubName').addEventListener('input', () => {
            updatePreview();
            saveData();
        });
        document.getElementById('courseName').addEventListener('input', () => {
            updatePreview();
            saveData();
        });
        document.getElementById('holeNumber').addEventListener('change', () => {
            updatePreview();
            saveData();
        });

        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        // Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js').then(registration => {
                console.log('Service Worker registered:', registration);
            }).catch(error => {
                console.log('Service Worker registration failed:', error);
            });
        }
    </script>
</body>
</html>